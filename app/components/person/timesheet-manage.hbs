<UiSection>
  <:title>{{@year}} Timesheet Entries</:title>
  <:body>
    <span class="me-2">
    <b>Credits:</b> {{credits-format @timesheetSummary.total_credits}}
    </span>
    <span class="me-2">
    <b>Counted Hours Towards Appreciations:</b>
      {{hour-minute-format @timesheetSummary.counted_duration}}
    </span>
    <b>Total Hours:</b>
    {{hour-minute-format @timesheetSummary.total_duration}}
    <div class="d-flex mt-1">
      <div>
        <HoursDoCountLegend />
      </div>
      {{#if this.hasOverlapping}}
        <div class="ms-2">
          {{fa-icon "flag" color="danger"}} = entry's time overlaps with another entry.
        </div>
      {{/if}}
    </div>
    <UiTable>
      <thead>
      <tr>
        <th>&nbsp;</th>
        <th>Time</th>
        <th class="text-end">Duration</th>
        <th class="text-end">Credits</th>
        <th>Position</th>
        <th class="text-center">Status</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      {{#each @timesheets key="id" as |ts|}}
        <tr class="align-middle">
          <td>
            {{#if (is-empty ts.off_duty)}}
              {{fa-icon "person-walking"}}
            {{else if ts.isVerified}}
              {{fa-icon "check" color="success"}}
            {{else if ts.isUnverified}}
              {{fa-icon "question"}}
            {{else if ts.isPending}}
              {{fa-icon "arrow-right" color="danger"}}
            {{else if ts.isRejected}}
              {{fa-icon "times"}}
            {{else if ts.isApproved}}
              {{fa-icon "thumbs-up" type="far"}}
            {{else}}
              &nbsp;
            {{/if}}
          </td>
          <td>
            {{#if ts.isOverlapping}}
              {{fa-icon "flag" color="danger" right=1}}
            {{/if}}
            {{#if ts.off_duty}}
              {{shift-format ts.on_duty ts.off_duty}}
            {{else}}
              {{shift-format ts.on_duty}}
            {{/if}}
            {{#unless ts.suppress_duration_warning}}
              {{#if ts.isTooShort}}
                <div class="text-danger">
                  Entry might be too short.
                </div>
              {{else if ts.isTooLong}}
                <div class="text-danger">
                  Entry might be too long.
                </div>
              {{/if}}
              {{#if ts.timesOutsideRange}}
                <div class="text-danger">
                  Times are outside scheduled sign-ups.
                </div>
              {{/if}}
            {{/unless}}
          </td>
          <td class="text-end">
            {{#unless ts.position.count_hours}}
              <NoAppreciateIcon/>
            {{/unless}}
            {{hour-minute-format ts.duration}}
          </td>
          <td class="text-end">
            {{credits-format ts.credits}}
          </td>
          <td>
            {{ts.position.title}}
            {{#if ts.is_non_ranger}}
              <br><i>(as non ranger volunteer)</i>
            {{/if}}
          </td>
          <td class="text-center">
            {{#if (is-empty ts.off_duty)}}
              {{badge "warning" "Still On Duty"}}
            {{else if ts.isVerified}}
              {{badge "success" "Verified"}}
            {{else if ts.isApproved}}
              {{badge "success" "Correction Approved"}}<br>
              {{badge "secondary" "Verification still needed"}}
            {{else if ts.isUnverified}}
              {{badge "secondary" "Unverified"}}
            {{else if ts.isPending}}
              {{badge "danger" "Correction Requested"}}
            {{else if ts.isRejected}}
              {{badge "warning" "Correction Rejected"}}
            {{else}}
              &nbsp;
            {{/if}}
          </td>
          <td>
            {{#if (is-empty ts.off_duty)}}
              <UiButton @type="danger" @size="sm" @onClick={{fn this.signoffAction ts}}>
                End Shift
              </UiButton>
            {{else}}
              <UiButton @type={{if ts.isPending "danger" "primary"}}
                        @size="sm"
                        @onClick={{fn this.editEntryAction ts}}
                        @disabled={{ts.isReloading}}>
                {{#if this.canManageTimesheets}}
                  {{fa-icon "edit"}} {{if ts.isPending "Review" "Edit"}}
                {{else}}
                  {{fa-icon "magnifying-glass"}} View
                {{/if}}
              </UiButton>
            {{/if}}
            {{#if ts.isReloading}}
              <SpinIcon/>
            {{/if}}
          </td>
        </tr>
      {{else}}
        <tr>
          <td>&nbsp;</td>
          <td colspan="6"><b class="mt-2 text-danger">No timesheet entries found for {{@year}}</b></td>
        </tr>
      {{/each}}
      </tbody>
    </UiTable>
  </:body>
</UiSection>

{{#if this.editEntry}}
  <Person::TimesheetEditModal @entry={{this.editEntry}}
                              @person={{@person}}
                              @saveEntryAction={{this.saveEntryAction}}
                              @canManageTimesheets={{this.canManageTimesheets}}
                              @positionOptions={{this.positionOptions}}
                              @showDeleteDialogAction={{this.showDeleteDialogAction}}
                              @cancelEntryAction={{this.cancelEntryAction}}
  />
{{/if}}

{{#if this.deleteEntry}}
  <ModalDialog
    @title="Confirm Timesheet Deletion"
    @onEscape={{this.cancelDeleteDialogAction}}
    as |Modal|>
    <Modal.body>
      {{#if this.deleteEntry.isDirty}}
        You have edited this entry without saving the record first. Do you wish to save the entry
        before deletion so the edits are retained in the timesheet log?
      {{else}}
        Are you absolutely sure you want to delete this entry?
      {{/if}}
    </Modal.body>
    <Modal.footer>
      <UiCancelButton @onClick={{this.cancelDeleteDialogAction}} />
      {{#if this.deleteEntry.isDirty}}
        <UiButton @onClick={{fn this.deleteEntryAction false}} @type="secondary">
          Delete w/o Saving
        </UiButton>
        <UiButton @onClick={{fn this.deleteEntryAction true}} @type="danger">
          Save &amp; Delete
        </UiButton>
      {{else}}
        <UiButton @onClick={{fn this.deleteEntryAction false}} @type="danger">
          Delete
        </UiButton>
      {{/if}}
    </Modal.footer>
  </ModalDialog>
{{/if}}