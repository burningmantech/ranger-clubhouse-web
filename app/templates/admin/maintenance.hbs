<main>
  <h1>Maintenance Tasks {{#if this.task}}- {{this.task.title}}{{/if}}</h1>
  <p>
    All ticketing and provision maintenance functions have been moved to the Vol Coord &gt; Access Documents &gt;
    Maintenance page.
  </p>
  {{#if this.isSubmitting}}
    <LoadingPane @text={{concat "The task '" this.task.title "' is being performed. Hang tight!"}} />
  {{else if this.task}}
    <p>
      <a href {{action this.showIndex}}>{{fa-icon "angle-double-left"}} Back to Maintenance Tasks</a>
    </p>

    {{#if (eq this.taskAction "mark-off-site")}}
      <p>
        {{pluralize this.results.count "person"}} have been marked off-site.
      </p>
    {{else if (eq this.taskAction "reset-pnvs")}}
      {{#if this.results.people}}
        <b>{{pluralize this.results.people.length  "PNV"}} reset to Past Prospective</b>
        <table class="table table-striped table-hover table-width-auto">
          <thead>
          <tr>
            <th>Old Callsign</th>
            <th>New Callsign</th>
            <th>Old Status</th>
          </tr>
          </thead>
          <tbody>
          {{#each this.results.people as |person|}}
            <tr>
              <td>
                <PersonLink @person={{person}} />
              </td>
              <td>{{person.callsign_reset}}</td>
              <td>{{person.status}}</td>
            </tr>
            {{#if person.error}}
              <tr>
                <td colspan="3" class="text-danger">Error: {{person.error}}</td>
              </tr>
            {{/if}}
          {{/each}}
          </tbody>
        </table>
      {{else}}
        <p class="text-danger"><b>No PNVs were found.</b></p>
      {{/if}}
    {{else if (eq this.taskAction "reset-past-prospectives")}}
      {{#if this.results.people}}
        <b>{{pluralize this.results.people.length  "Past Prospective"}} with approved callsign(s) were reset</b>
        <table class="table table-striped table-hover table-width-auto">
          <thead>
          <tr>
            <th>Old Callsign</th>
            <th>New Callsign</th>
          </tr>
          </thead>
          <tbody>
          {{#each this.results.people as |person|}}
            <tr>
              <td>
                <PersonLink @person={{person}} />
              </td>
              <td>{{person.callsign_reset}}</td>
            </tr>
            {{#if person.error}}
              <tr>
                <td colspan="2" class="text-danger">Error: {{person.error}}</td>
              </tr>
            {{/if}}
          {{else}}
            <tr>
              <td colspan="2">No Past Prospectives with approved callsigns were found.</td>
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{else}}
        <p class="text-danger"><b>No Past Prospectives with approved callsigns were found.</b></p>
      {{/if}}
    {{else if (eq this.taskAction "bump-expiration")}}
    {{else if (eq this.taskAction "set-bmid-titles")}}
      {{#if this.results.bmids}}
        <p>
          Note: only titles that were set will be shown. A title set prior to this will not appear below.
        </p>
        {{pluralize this.results.bmids.length "BMID"}} were set.
        <table class="table table-striped table-hover table-sm table-width-auto">
          <thead>
          <tr>
            <th>Callsign</th>
            <th>Status</th>
            <th>Title 1</th>
            <th>Title 2</th>
            <th>Title 3</th>
          </tr>
          </thead>
          <tbody>
          {{#each this.results.bmids as |bmid|}}
            <tr>
              <td>
                <PersonLink @person={{bmid}} @page="bmid"/>
              </td>
              <td>{{bmid.status}}</td>
              <td>{{#if bmid.title1}}{{bmid.title1}}{{else}}&nbsp;{{/if}}</td>
              <td>{{#if bmid.title2}}{{bmid.title2}}{{else}}&nbsp;{{/if}}</td>
              <td>{{#if bmid.title3}}{{bmid.title3}}{{else}}&nbsp;{{/if}}</td>
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{else}}
        <p class="text-danger">
          <b>It appears all qualifying BMIDs have the titles already set.</b>
        </p>
      {{/if}}
    {{else if (eq this.taskAction "archive-messages")}}
      {{#if (eq this.results.status "success")}}
        <p class="text-success">
          Congratulations! The {{this.results.year}} messages were successfully archived into a separate table.
        </p>
      {{else if (eq this.results.status "archive-exists")}}
        <p class="text-danger">
          <b>The {{this.results.year}} messages have been already archived. The archive table already exists.</b>
        </p>
      {{else}}
        <p class="text-danger">
          <b>Uh oh, I don't understand the server response "{{this.results.status}}".</b>
        </p>
      {{/if}}
    {{else}}
      Uh oh, I don't understand the task "{{this.taskAction}}". This is a BUG. Please report this to the Tech Team.
    {{/if}}
  {{else}}
    {{#each this.taskGroups as |group|}}
      <UiSection>
        <:title>{{group.group_title}}</:title>
        <:body>
          <table class="table table-striped">
            <tbody>
            {{#each group.tasks as |task|}}
              <tr>
                <td class="w-30">
                  {{#if task.param}}
                    <UiButton @class="btn-block" @onClick={{fn this.askParamAction task}}>
                      {{task.title}}
                    </UiButton>
                  {{else}}
                    <UiButton @class="btn-block" @onClick={{fn this.executeTask task}}>
                      {{task.title}}
                    </UiButton>
                  {{/if}}
                </td>
                <td class="w-70">
                  {{task.description}}
                </td>
              </tr>
            {{/each}}
            </tbody>
          </table>
        </:body>
      </UiSection>
    {{/each}}
  {{/if}}

  {{#if this.taskParam}}
    <ModalDialog @onEscape={{this.cancelParamAction}} as |Modal|>
      <Modal.body>
        <FormRow>
          <FormLabel>{{this.taskParam.param.title}}</FormLabel>
        </FormRow>
        <FormRow>
          <div class="col-auto">
            <Input @type="text" size="80" class="form-control" @value={{this.paramValue}}/>
          </div>
        </FormRow>
      </Modal.body>
      <Modal.footer @noAlign={{true}}>
        <UiButton @onClick={{fn this.executeTask this.taskParam}}>Submit</UiButton>
        <UiCancelButton @onClick={{this.cancelParamAction}} />
      </Modal.footer>
    </ModalDialog>
  {{/if}}
</main>